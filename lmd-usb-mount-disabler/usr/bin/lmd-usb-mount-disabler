#!/bin/bash

logger -t "Ltsp-usb-mount-disabler" "Checking automount"
rc=0
lliurex-version -t "server" || rc=1

if [ $rc -eq 0 ]; then
	Z=$(echo $DISPLAY | cut -d ":" -f 1)
	if [ ! -z $Z ]; then
		logger -t "Ltsp-usb-mount-disabler" "Disabling automount on ThinClients"
		dconf write /org/mate/desktop/media-handling/automount false
		dconf write /org/mate/desktop/media-handling/automount-open false
		dconf write /org/mate/caja/desktop/volumes-visible false 
	else

		logger -t "Ltsp-usb-mount-disabler" "Disabling automount on ThinClients"
		dconf write /org/mate/desktop/media-handling/automount true 
		dconf write /org/mate/desktop/media-handling/automount-open true
		dconf write /org/mate/caja/desktop/volumes-visible true
	fi
	 
else
	logger -t "Ltsp-usb-mount-disabler" "Checking automount: Nothing to do"

	dconf write /org/mate/desktop/media-handling/automount true 
	dconf write /org/mate/desktop/media-handling/automount-open true
	dconf write /org/mate/caja/desktop/volumes-visible true
fi


exit 0
